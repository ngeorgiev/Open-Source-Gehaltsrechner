/**
 * Copyright (c) 2012 Brad Harris - bmharris@gmail.com
 * https://github.com/bmharris/slikcalc
 * Code licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 * version 2.0.1
 */
var slikcalc;if(!slikcalc)slikcalc={};else if(typeof slikcalc!="object")throw new Error("slikcalc already exists and is not an object");(function(){"use strict",slikcalc={precision:2,adapter:null,getValue:function(a){var b=null,c=this.get(a);return c!==null&&(b=this.isInput(c)?c.value:c.innerHTML),b},setValue:function(a,b){var c=this.get(a);c!==null&&(this.isInput(c)?c.value=b:c.innerHTML=b)},getAmount:function(a){var b=this.getValue(a);return b=b!==null?parseFloat(this.formatCurrency(b)):parseFloat(this.formatCurrency(0)),b},setAmount:function(a,b){this.setValue(a,this.formatCurrency(b))},isInput:function(a){return a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.tagName==="SELECT"},formatCurrency:function(a){return a!==undefined&&typeof a=="string"&&(a=a.replace(/[$,]/,"")),a=isNaN(a)||a===""||a===null?0:a,parseFloat(a).toFixed(slikcalc.precision)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},get:function(a){return this.validateAdapter(),this.adapter.get(a)},validateAdapter:function(){if(this.adapter===null)throw new Error("slikcalc requires an external javascript library adapter")},addListener:function(a,b,c,d){this.validateAdapter(),this.adapter.addListener(a,b,c,d)},addOnLoad:function(a,b){this.validateAdapter(),this.adapter.addOnLoad(a,b)},createCustomEvent:function(a){return this.validateAdapter(),this.adapter.createCustomEvent(a)},bindEvent:function(a,b,c){this.validateAdapter(),this.adapter.bindEvent(a,b,c)},fireEvent:function(a){this.validateAdapter(),this.adapter.fireEvent(a)},extend:function(a,b){if(!b||!a)throw new Error("slikcalc.extend failed, please check that all dependencies are included.");var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.prototype.parent=b.prototype,a.prototype.parent.constructor=b},create:function(a,b){var c={column:slikcalc.ColumnCalc,formula:slikcalc.FormulaCalc};return c[a]?new c[a](b):null}}})();var slikcalc;(function(){function b(a,b,c,d){var e=function(){c.call(d)};a=typeof a=="string"?slikcalc.adapter.get(a):a,a.addEventListener?a.addEventListener(b,e,!1):a.attachEvent&&a.attachEvent("on"+b,e)}"use strict";var a=!1;slikcalc.adapter={get:function(a){return document.getElementById(a)},addListener:function(c,d,e,f){a?b(c,d,e,f):slikcalc.adapter.addOnLoad(function(){b(c,d,e,f)})},addOnLoad:function(c,d){a?c.call(d):b(window,"load",c,d)},createCustomEvent:function(a){return new slikcalc.adapter.Event},bindEvent:function(a,b,c){a.subscribe(b,c)},fireEvent:function(a){a.fire()}},slikcalc.adapter.addOnLoad(function(){a=!0}),slikcalc.adapter.Event=function(){this._subscribers=[]},slikcalc.adapter.Event.prototype={_subscribers:null,subscribe:function(a,b){this._subscribers.push({cb:a,scope:b})},fire:function(){var a,b;for(a in this._subscribers)this._subscribers.hasOwnProperty(a)&&(b=this._subscribers[a],b.cb.call(b.scope))}}})();var slikcalc;(function(){"use strict",slikcalc.BaseCalc=function(a){a=a||{},a.total=a.total||{},this.totalId=a.total.id||null,this.totalOperator=a.total.operator||"+",this.calcOnLoad=a.calcOnLoad||!1,this.calculationComplete=slikcalc.createCustomEvent("calculationComplete"),this.registerListeners=a.registerListeners||!1,slikcalc.addOnLoad(this.baseInitialize,this),this.config=a},slikcalc.BaseCalc.prototype={config:null,calculationComplete:null,lastKeyUp:null,calculations:0,totalId:null,totalOperator:null,calcOnLoad:!1,registerListeners:!1,keyupDelay:600,initialized:!1,baseInitialize:function(){this.initialized===!1&&(this.initialized=!0,this.initialize!==undefined&&typeof this.initialize=="function"&&this.initialize(),this.calcOnLoad===!0&&this.processCalculation())},dependsOn:function(a){return slikcalc.bindEvent(a.calculationComplete,this.processCalculation,this),a},triggers:function(a){return slikcalc.bindEvent(this.calculationComplete,a.processCalculation,a),a},keyupEvent:function(){this.lastKeyup=(new Date).getTime(),this.calculations=this.calculations+1;var a=this,b=this.calculations;setTimeout(function(){var c=(new Date).getTime(),d=c-a.lastKeyup;b===a.calculations&&d>a.keyupDelay&&a.processCalculation()},this.keyupDelay+100)},calculateTotal:function(a,b){return this.totalOperator==="+"?(a=a===null?0:a,a+=b):this.totalOperator==="-"?a===null?a=b:a-=b:this.totalOperator==="*"||this.totalOperator==="x"?(a=a===null?1:a,a*=b):this.totalOperator==="/"&&(a===null?a=b:a/=b),a},processCalculation:function(){this.initialized===!1&&this.baseInitialize(),this.calculate(),slikcalc.fireEvent(this.calculationComplete)},calculate:function(){throw new Error("Must implement calculate method in sub-class of BaseCalc")}}})();var slikcalc;(function(){"use strict",slikcalc.ColumnCalc=function(a){this.parent.constructor.call(this,a),this.rows=[]},slikcalc.extend(slikcalc.ColumnCalc,slikcalc.BaseCalc),slikcalc.ColumnCalc.prototype.rows=null,slikcalc.ColumnCalc.prototype.initialize=function(){this.registerListeners===!0&&this.setupEventListeners()},slikcalc.ColumnCalc.prototype.calculate=function(){var a,b,c=!1,d=null;for(a in this.rows)this.rows.hasOwnProperty(a)&&(c=!0,this.rows[a].checkbox!==undefined&&(b=this.rows[a].checkbox,c=b.invert!==slikcalc.get(b.id).checked),c===!0&&(d=this.calculateTotal(d,slikcalc.getAmount(this.rows[a].id))));slikcalc.setAmount(this.totalId,d)},slikcalc.ColumnCalc.prototype.setupEventListeners=function(){var a,b;for(a in this.rows)this.rows.hasOwnProperty(a)&&(b=this.rows[a],b.checkbox!==undefined&&slikcalc.addListener(b.checkbox.id,"click",this.processCalculation,this),slikcalc.addListener(b.id,"keyup",this.keyupEvent,this))},slikcalc.ColumnCalc.prototype.addRow=function(a){a=a||{},a.checkbox!==undefined&&(a.checkbox.invert=a.checkbox.invert||!1),this.rows.push(a)}})();var slikcalc;(function(){"use strict",slikcalc.FormulaCalc=function(a){this.parent.constructor.call(this,a),this.formula=this.config.formula||"",this.rows=[],this.variables=[],this.config.vars!==undefined&&this.addRow({vars:this.config.vars})},slikcalc.extend(slikcalc.FormulaCalc,slikcalc.BaseCalc),slikcalc.FormulaCalc.prototype.formula=null,slikcalc.FormulaCalc.prototype.formulaParsed=null,slikcalc.FormulaCalc.prototype.resultVar=null,slikcalc.FormulaCalc.prototype.varMatch=/\{(\w)\}/gi,slikcalc.FormulaCalc.prototype.rows=null,slikcalc.FormulaCalc.prototype.variables=null,slikcalc.FormulaCalc.prototype.initialize=function(){var a,b;this.formulaParsed=this.formula,this.formulaParsed.indexOf("=")!==-1&&(b=this.formulaParsed.split("="),this.formulaParsed=b[0],this.resultVar=this.varMatch.exec(slikcalc.trim(b[1]))[1]),this.varMatch.lastIndex=0;while((a=this.varMatch.exec(this.formulaParsed))!==null)this.variables.push(a[1]);this.varMatch.lastIndex=0},slikcalc.FormulaCalc.prototype.addRow=function(a){var b,c;a=a||{},c=a.vars=a.vars||{},a.checkbox!==undefined&&(slikcalc.addListener(a.checkbox.id,"click",this.processCalculation,this),a.checkbox.invert=a.checkbox.invert||!1);for(b in c)c.hasOwnProperty(b)&&(c[b].defaultValue=c[b].defaultValue||0,a.registerListeners=a.registerListeners===!0||this.registerListeners===!0&&a.registerListeners!==!1,a.registerListeners===!0&&slikcalc.addListener(c[b].id,"keyup",this.keyupEvent,this));this.rows.push(a)},slikcalc.FormulaCalc.prototype.calculate=function(){var total=0,rows=this.rows,idx,varIdx,includeRow,formulaString,rowTotal,variable,variableName,variableRegex,value;for(idx in rows)if(rows.hasOwnProperty(idx)){includeRow=!0,formulaString=this.formulaParsed,rowTotal=0,rows[idx].checkbox!==undefined&&(includeRow=rows[idx].checkbox.invert!==slikcalc.get(rows[idx].checkbox.id).checked);for(varIdx in this.variables)this.variables.hasOwnProperty(varIdx)&&(variableName=this.variables[varIdx],variable=rows[idx].vars[variableName],value=variable.defaultValue,slikcalc.get(variable.id)!==null&&(value=slikcalc.getValue(variable.id),value=value===""?variable.defaultValue:value,value=slikcalc.formatCurrency(value)),variableRegex=new RegExp("\\{"+variableName+"\\}"),formulaString=formulaString.replace(variableRegex,value));rowTotal=slikcalc.formatCurrency(eval(formulaString)),this.resultVar!==null&&slikcalc.setAmount(rows[idx].vars[this.resultVar].id,rowTotal),includeRow===!0&&this.totalOperator!==null&&(total=this.calculateTotal(total,parseFloat(rowTotal)))}this.totalId!==null&&slikcalc.setAmount(this.totalId,total)}})()
